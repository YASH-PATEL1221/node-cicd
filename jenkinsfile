pipeline{
    agent any

    tools{
        nodejs "nodejs"
    }

    stages{
        stage('git checkout') {
            steps{
                git credentialsId: 'github-ssh', url: 'git@github.com:YASH-PATEL1221/node-cicd.git'
            }
        }

        stage('install dependency'){
            steps{
                sh 'npm install'
            }
        }

        stage('docker build'){
            steps{
                    script{
                        withDockerRegistry(credentialsId: 'docker-login', toolName: 'docker') {
                            sh "docker build -t temp-node ."
                            sh "docker tag temp-node yashpatel274/temp-node:1"
                            sh "docker push yashpatel274/temp-node:1"
                        }
                    }
            }
        }
    }
}